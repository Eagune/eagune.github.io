{"meta":{"title":"Eagune's Blog","subtitle":"","description":"","author":"Eagune","url":"http://yoursite.com","root":"/"},"pages":[],"posts":[{"title":"（三）Dep依赖收集","slug":"vue深入理解/Dep依赖收集","date":"2020-04-25T13:33:50.000Z","updated":"2020-04-26T01:09:52.713Z","comments":true,"path":"2020/04/25/vue深入理解/Dep依赖收集/","link":"","permalink":"http://yoursite.com/2020/04/25/vue%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/Dep%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86/","excerpt":"","text":"","categories":[{"name":"vue深入理解","slug":"vue深入理解","permalink":"http://yoursite.com/categories/vue%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"Dep","slug":"Dep","permalink":"http://yoursite.com/tags/Dep/"}]},{"title":"（二）Observer将数据对象变成响应式","slug":"vue深入理解/Observer将数据对象变成响应式","date":"2020-04-25T09:43:39.000Z","updated":"2020-04-26T01:09:52.713Z","comments":true,"path":"2020/04/25/vue深入理解/Observer将数据对象变成响应式/","link":"","permalink":"http://yoursite.com/2020/04/25/vue%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/Observer%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1%E5%8F%98%E6%88%90%E5%93%8D%E5%BA%94%E5%BC%8F/","excerpt":"","text":"我们已经知道了变化侦测的原理了，并且知道了Object和Array的不同，现在我们封装一个Observer类，将一个数据对象中的所有属性都进行追踪。 123456789101112131415161718192021222324252627282930313233343536class Observer &#123; constructor(value) &#123; this.value = value; if (!Array.isArray(value)) &#123; this.walk(value); &#125; else &#123; value.__proto__ = arrayMethods; &#125; &#125; walk(object) &#123; for (let key in object) &#123; defineReactive(object, key, object[key]); &#125; &#125;&#125;function defineReactive(data, key, value) &#123; if (typeof value === 'object') &#123; new Observer(value); &#125; Object.defineProperty(data, key, &#123; enumerable: true, configurable: true, get: function() &#123; return value; &#125;, set: function(newVal) &#123; if (value === newVal) &#123; return; &#125; value = newVal; &#125; &#125;);&#125; 查看DEMO","categories":[{"name":"vue深入理解","slug":"vue深入理解","permalink":"http://yoursite.com/categories/vue%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"Observer","slug":"Observer","permalink":"http://yoursite.com/tags/Observer/"}]},{"title":"（一）Vue中的变化侦测的原理","slug":"vue深入理解/Vue中的变化侦测的原理","date":"2020-04-24T19:16:26.000Z","updated":"2020-04-26T01:09:52.713Z","comments":true,"path":"2020/04/24/vue深入理解/Vue中的变化侦测的原理/","link":"","permalink":"http://yoursite.com/2020/04/24/vue%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/Vue%E4%B8%AD%E7%9A%84%E5%8F%98%E5%8C%96%E4%BE%A6%E6%B5%8B%E7%9A%84%E5%8E%9F%E7%90%86/","excerpt":"","text":"变化侦测是Vue中实现响应式的核心。它的作用是当数据变化时，通知视图进行相应的更新。 Object的变化侦测在javascript中有两种方法可以侦测到一个对象的变化：Object.defineProperty和ES6的Proxy。 12345678910111213function defineReactive(obj, property, value) &#123; Object.defineProperty(obj, property, &#123; enumerable: true, configurable: true, get: function() &#123; return value; &#125;, set: function(newValue) &#123; if (newValue === value) return value = newValue; &#125;, &#125;)&#125; 查看DEMO Array的变化侦测在对Object进行变化侦测的时候是使用getter/setter的方式来进行追踪。而用push等方法来改变数组中的内容时并不会出发setter。因此我们采用拦截器的方式覆盖Array.prototype来对数组进行追踪。 123456789101112131415161718192021const arrayProto = Array.prototype;const arrayMethods = Object.create(arrayProto);[ 'push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse'].forEach(function(method) &#123; const original = arrayProto[method]; Object.defineProperty(arrayMethods, method, &#123; value: function mutator(...args) &#123;//使用rest参数可以避免将argumesnts对象转换为数组 return original.apply(this, args) &#125;, enumerable: false, //不让方法出现在枚举属性中 writable: true, configurable: true, &#125;)&#125;) 查看DEMO","categories":[{"name":"vue深入理解","slug":"vue深入理解","permalink":"http://yoursite.com/categories/vue%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"变化侦测","slug":"变化侦测","permalink":"http://yoursite.com/tags/%E5%8F%98%E5%8C%96%E4%BE%A6%E6%B5%8B/"}]}],"categories":[{"name":"vue深入理解","slug":"vue深入理解","permalink":"http://yoursite.com/categories/vue%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"Dep","slug":"Dep","permalink":"http://yoursite.com/tags/Dep/"},{"name":"Observer","slug":"Observer","permalink":"http://yoursite.com/tags/Observer/"},{"name":"变化侦测","slug":"变化侦测","permalink":"http://yoursite.com/tags/%E5%8F%98%E5%8C%96%E4%BE%A6%E6%B5%8B/"}]}