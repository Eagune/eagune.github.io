<!DOCTYPE html><html><head><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title></title><link href="/demo/vendor.css" rel="stylesheet"><link href="/demo/client.css" rel="stylesheet"></head><body><div id="app"></div><script>window.HtmlCode='<div id="app"></div>',window.HtmlFold=[],window.CssCode="",window.CssFold=[],window.JsCode="class Observer {\n  constructor(value) {\n    this.value = value;\n\n    if (!Array.isArray(value)) {\n      this.walk(value);\n    } else {\n      value.__proto__ = arrayMethods;\n    }\n  }\n\n  walk(object) {\n    for (let key in object) {\n      defineReactive(object, key, object[key]);\n    }\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  if (typeof value === 'object') {\n    new Observer(value);\n  }\n  let deps = [];\n  Object.defineProperty(data, key, {\n    enumerable: true,\n    configurable: true,\n    get: function() {\n      if(window.target) {\n        deps.push(window.target);\n      }\n      return value;\n    },\n    set: function(newVal) {\n      if (value === newVal) {\n        return;\n      }\n      value = newVal;\n      for (let i = 0; i < deps.length; i++) {\n        deps[i].update();\n      }\n      if (typeof value === 'object') {\n        new Observer(value);\n      }\n    }\n  });\n}\n\nfunction parsePath(path) {\n  const segments = path.split('.')\n  return function(obj) {\n    for (let i = 0; i < segments.length; i++) {\n      if (!obj) return;\n      obj = obj[segments[i]];\n    }\n    return obj;\n  }\n}\n\nclass Watcher {\n  constructor(vm, expression, cb) {\n    this.vm = vm;\n    this.getter = parsePath(expression);\n    this.cb = cb;\n    \n    window.target = this;\n    this.value = this.getter.call(this.vm, this.vm);\n    window.target = undefined;\n    \n    this.cb.call(this.vm, this.value);\n  }\n\n  update() {\n    const oldValue = this.value;\n    this.value = this.getter.call(this.vm, this.vm);\n    this.cb.call(this.vm, this.value, oldValue);\n  }\n}\n\nconst tagRE = /<([\\w:-]+)/\nconst entityRE = /&#?w+?;/\nconst commentRE = /<!--/\n\nfunction stringToFragment (templateString) {\n  var frag = document.createDocumentFragment()\n  var tagMatch = templateString.match(tagRE)\n  var entityMatch = entityRE.test(templateString)\n  var commentMatch = commentRE.test(templateString)\n\n  if (!tagMatch && !entityMatch && !commentMatch) {\n    // text only, return a single text node.\n    frag.appendChild(\n      document.createTextNode(templateString)\n    )\n  } else {\n    var node = document.createElement('div')\n    node.innerHTML = templateString\n    frag.appendChild(node)\n  }\n  return frag\n}\n\nfunction replace (target, el) {\n  var parent = target.parentNode\n  if (parent) {\n    parent.replaceChild(el, target)\n  }\n}\n\nfunction transcludeTemplate (el, template) {\n  var frag = stringToFragment(template)\n  var replacer = frag.firstChild\n  var attrs = el.attributes\n  var i = attrs.length\n  var name, value\n  while (i--) {\n    name = attrs[i].name\n    value = attrs[i].value\n    if (!replacer.hasAttribute(name)) {\n      replacer.setAttribute(name, value)\n    }\n  }\n  return replacer\n}\n\nfunction parseText (text) {\n  var tagRE = /\{\{((?:.|\\n)+?)\}\}/g\n  if (!tagRE.test(text)) {\n    return null\n  }\n  var tokens = []\n  var lastIndex = tagRE.lastIndex = 0\n  var match, index, html, value\n  while (match = tagRE.exec(text)) {\n    index = match.index\n    // push text token\n    if (index > lastIndex) {\n      tokens.push({\n        value: text.slice(lastIndex, index)\n      })\n    }\n    // tag token\n    value = match[1]\n    tokens.push({\n      tag: true,\n      value: value.trim(),\n    })\n    lastIndex = index + match[0].length\n  }\n  if (lastIndex < text.length) {\n    tokens.push({\n      value: text.slice(lastIndex)\n    })\n  }\n  return tokens\n}\n\nfunction init (el, template) {\n  var origin = el\n  el = transcludeTemplate(el, template)\n  compile(el)\n  replace(origin, el)\n  return el\n}\n\nfunction compile(el){\n  if (el.hasChildNodes()) {\n    compileNodeList(el.childNodes)\n  }\n}\n\nfunction compileNodeList(nodeList){\n  var node\n  for (var i = 0, l = nodeList.length; i < l; i++) {\n    node = nodeList[i]\n    compileNode(node)\n    if (node.hasChildNodes()) {\n      compileNodeList(node.childNodes)\n    }\n  }\n}\n\nfunction compileNode (node) {\n  var type = node.nodeType\n  if (type === 3 && node.data.trim()) {\n    compileTextNode(node)\n  }\n}\n\nfunction compileTextNode (node) {\n  var tokens = parseText(node.wholeText)\n  if (!tokens) {\n    return null\n  }\n  var frag = document.createDocumentFragment()\n  var el, token\n  for (var i = 0, l = tokens.length; i < l; i++) {\n    token = tokens[i]\n    if (token.tag) {\n      el = document.createTextNode(' ')\n      new Watcher(data, token.value, function(value, oldValue) {\n        var attr = el.nodeType === 3 ? 'data' : 'textContent';\n        el[attr] = value == null ? '' : value.toString()\n      });\n    } else {\n      el = document.createTextNode(token.value)\n    }\n    frag.appendChild(el)\n  }\n  replace(node, frag)\n}\n\nvar data = {\n  info: {\n    name: 'Jhon',\n  },\n  age: 18,\n};\nnew Observer(data);\nvar root = document.querySelector('#app')\ninit(root,'<div><p>姓名{{info.name}}</p><p>年纪{{age}}</p></div>')",window.JsFold=[0,18,47,58,82,101,108,124]</script><script type="text/javascript" src="/demo/manifest.js"></script><script type="text/javascript" src="/demo/vendor.js"></script><script type="text/javascript" src="/demo/client.js"></script></body></html>