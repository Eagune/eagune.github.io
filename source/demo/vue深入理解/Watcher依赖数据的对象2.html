<!DOCTYPE html><html><head><meta http-equiv="Content-type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title></title><link href="/demo/vendor.css" rel="stylesheet"><link href="/demo/client.css" rel="stylesheet"></head><body><div id="app"></div><script>window.HtmlCode='<div>\n  名称：<span id="name"></span>\n</div>\n<div>\n  技能：<span id="skill"></span>\n</div>\n',window.HtmlFold=[],window.CssCode="",window.CssFold=[],window.JsCode="class Observer {\n  constructor(value) {\n    this.value = value;\n\n    if (!Array.isArray(value)) {\n      this.walk(value);\n    } else {\n      this.deps = [];\n      let instance = this;\n      Object.defineProperty(value, '__ob__', {\n        value: instance,\n        enumerable: false,\n        writable: true,\n        configurable: true,\n      });\n      value.__proto__ = arrayMethods;\n    }\n  }\n\n  walk(object) {\n    for (let key in object) {\n      defineReactive(object, key, object[key]);\n    }\n  }\n}\n\nconst arrayProto = Array.prototype;\nconst arrayMethods = Object.create(arrayProto);\n[\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'sort',\n  'reverse'\n].forEach(function(method) {\n  const original = arrayProto[method];\n  Object.defineProperty(arrayMethods, method, {\n    value: function mutator(...args) {\n      const result = original.apply(this, args);\n      let deps = this.__ob__.deps;\n      for (let i = 0; i < deps.length; i++) {\n        deps[i].update();\n      }\n      return result;\n    },\n    enumerable: false,\n    writable: true,\n    configurable: true,\n  })\n})\n\nfunction defineReactive(data, key, value) {\n  let instance;\n  if (typeof value === 'object') {\n    instance = new Observer(value);\n  }\n  let deps = [];\n  Object.defineProperty(data, key, {\n    enumerable: true,\n    configurable: true,\n    get: function() {\n      if(window.target) {\n        deps.push(window.target);\n        if(instance && instance.deps) {\n          instance.deps.push(window.target);\n        }\n      }\n      return value;\n    },\n    set: function(newVal) {\n      if (value === newVal) {\n        return;\n      }\n      value = newVal;\n      for (let i = 0; i < deps.length; i++) {\n        deps[i].update();\n      }\n      if (typeof value === 'object') {\n        new Observer(value);\n      }\n    }\n  });\n}\n\nclass Watcher {\n  constructor(vm, key, cb) {\n    this.vm = vm;\n    this.key = key;\n    this.cb = cb;\n    \n    window.target = this;\n    this.value = this.vm[this.key];\n    window.target = undefined;\n    \n    this.cb.call(this.vm, this.value);\n  }\n\n  update() {\n    const oldValue = this.value;\n    this.value = this.vm[this.key];\n    this.cb.call(this.vm, this.value, oldValue);\n  }\n}\n\nvar data = {\n  name: 'Jhon',\n  age: 18,\n  skill: ['dance'],\n};\n\nnew Observer(data);\n\nnew Watcher(data, 'name', function(value, oldValue) {\n  document.getElementById('name').innerHTML = value;\n});\n\nnew Watcher(data, 'skill', function(value, oldValue) {\n  document.getElementById('skill').innerHTML = value;\n});\n\ndata.skill.push('sing');",window.JsFold=[4,19,28,71,86]</script><script type="text/javascript" src="/demo/manifest.js"></script><script type="text/javascript" src="/demo/vendor.js"></script><script type="text/javascript" src="/demo/client.js"></script></body></html>